image: docker:stable

variables:
  DOCKER_HOST: tcp://docker:2375/
  DOCKER_DRIVER: overlay2

services:
  - docker:dind

before_script:
  - docker info

build:
  stage: build
  script:
    - curl https://sh.rustup.rs -sSf | sh -s -- -v -y --default-toolchain stable
    - docker build -t hr567/ana .
    - cargo test -- --test-threads=1
